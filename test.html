 <!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>test modified by 刘传宗</title>
    <link rel="stylesheet" type="text/css" href="css/demo.css">
    <link rel="stylesheet" type="text/css" href="css/zTreeStyle/zTreeStyle.css">
    <link rel="stylesheet" type="text/css" href="css/mycss.css">
    <script type="text/javascript" src="js/jquery-1.12.4.js"></script>
    <script type="text/javascript" src="js/jquery.ztree.core.min.js"></script>
    <script type="text/javascript" src="js/jquery.ztree.excheck.min.js"></script>
    <script type="text/javascript" src="js/jquery.ztree.exedit.min.js"></script>
    <script type="text/javascript" src="js/jquery.ztree.exhide.js"></script>
</head>
<body>
    <div class="notice">
        <form action="">
            <table>
                <tr>
                    <td>接收方：</td>
                    <td>
                        <div>
                            <input type="text" name="receiver" placeholder="所有用户" onclick="showmodel()"/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>标题：<span>*</span></td>
                    <td>
                        <div>
                            <input type="text" name="title"/>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>重要程度：</td>
                    <td>
                        <div class="importance">
                            <input type="radio" name="importance" checked />一般
                            <input type="radio" name="importance" />保密
                        </div>
                    </td>
                </tr>
                <tr>
                    <td >正文：<span>*</span></td>
                    <td>
                        <div>
                            <textarea name="content" rows="10" style="border:0;width:100%;resize: none;"></textarea>
                        </div>

                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td>(请输入不少于3个字，不多于200个字的通告内容)</td>
                </tr>
            </table>
            <button type="submit">发布</button>
        </form>
    </div>

    <div class="model">
        <div class="model-dialog">
            <div class="model-content">
                <div class="model-title">
                    <p class="fl">添加接收方</p>
                    <div class="fr">
                        <img src="image/1.png" width="24" height="24" alt="" onclick="closemodel()"/>
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="model-body">
                    <div class="all fl">
                        <p>所有用户</p>
                        <div>
                            <div class="ztree-wrap">
                                <ul id="menu_tree_left" class="ztree"></ul>
                            </div>
                        </div>
                    </div>
                    <div class="middle fl">
                        <div><button id="add" onclick="addnodes();">添加</button></div>
                        <div><button id="addAll" onclick="addAllnodes();">添加下属部门</button></div>
                    </div>
                    <div class="selected fr">
                        <p>已选接收方</p>
                        <div>
                            <div class="ztree-wrap">
                                <ul id="menu_tree_right" class="ztree"></ul>
                            </div>
                        </div>
                        <form action="">
                            <input type="checkbox" name="users" checked/>所有用户
                        </form>
                    </div>
                </div>
                <div class="model-footer">
                    <div class="fl">
                        <button id="ensure">确定</button>
                    </div>
                    <div class="fr">
                        <button onclick="closemodel()">取消</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        function showmodel(){
            var model=document.getElementsByClassName('model')[0];
            model.style.display='block';
        }
        function closemodel(){
            var model=document.getElementsByClassName('model')[0];
            model.style.display='none';
        }

        var settingLeft = {
            data: {
                simpleData: {
                    enable: true
                }
            },
            view: {
                dblClickExpand: false,//双击节点时，是否自动展开父节点的标识
                showLine: false,//是否显示节点之间的连线
                showIcon: false,//是否显示图标
                fontCss: { 'color': '#354a5e' },//字体样式函数
                selectedMulti: false //设置是否允许同时选中多个节点
            },
            callback:{
                onClick: function (event, treeId, treeNode) {
                    zTree = $.fn.zTree.getZTreeObj("menu_tree_left");
                }
            }
        };
        var settingRight = {
            data: {
                simpleData: {
                    enable: true
                }
            },
            view: {
                dblClickExpand: false,//双击节点时，是否自动展开父节点的标识
                showLine: false,//是否显示节点之间的连线
                showIcon: false,//是否显示图标
                fontCss: { 'color': '#354a5e' },//字体样式函数
                selectedMulti: false //设置是否允许同时选中多个节点
            },
            edit: {
                enable: true,
                showRemoveBtn:true,
                showRenameBtn: false
            },
            callback:{
                onClick: function (event, treeId, treeNode) {
                    zTree = $.fn.zTree.getZTreeObj("menu_tree_right");
                },
                beforeRemove:function(){
                    
                }
            }
        };


        var zNodes = [
            { id:1, pId:0, name:"湖南省公安厅"},
            { id:11, pId:1, name:"长沙市公安局"},
            { id:111, pId:11, name:"雨花分局"},
            { id:112, pId:11, name:"芙蓉分局"},
            { id:21, pId:1, name:"株洲市公安局"},
            { id:211, pId:21, name:"芦淞区分局"},
            { id:212, pId:21, name:"荷塘区分局"},
            { id:31, pId:1, name:"湘潭市公安局"},
            { id:311, pId:31, name:"雨湖分局"},
            { id:311, pId:31, name:"岳塘分局"},

        ];
        $(document).ready(function(){
            // 初始化 left tree,得到leftTree对象
            $.fn.zTree.init($("#menu_tree_left"), settingLeft, zNodes);
//            $.fn.zTree.init($("#menu_tree_right"), settingRight, []);

        });
        var rNodes=[];
        function addnodes() {
            var leftTree = $.fn.zTree.getZTreeObj("menu_tree_left");
            var nodesSelected=leftTree.getSelectedNodes()[0];

            if (!nodesSelected) return;

            // 已经添加到右侧的的节点名字
            var added = rNodes.map(function (node) { return node.name });

            // 已经添加过的不添加
            if (added.indexOf(nodesSelected.name) !== -1) return;

            rNodes.push(nodesSelected);

            rNodes = rNodes.map(function (node) {
                return $.extend({}, node, { children: [] });
            });

            $.fn.zTree.init($("#menu_tree_right"), settingRight, rNodes);

            // 5 被添加到“已接收方”的叶子节点，在左侧不显示
//            if (!nodesSelected.isParent) {
//                global.leftTree.hideNode(selectedNode);
//            }
            if(nodesSelected.isParent){
                $('.ztree li a.curSelectedNode').css({'color':'gray'});
            }
//            checkbox的状态控制
            var rightTree = $.fn.zTree.getZTreeObj("menu_tree_right");
            if(rightTree.getNodes()!=[]){
                $(':checkbox').attr("checked",false);
                $(':checkbox').click(function(){
                  $.fn.zTree.init($("#menu_tree_Right"), settingRight, []);
                  $.fn.zTree.init($("#menu_tree_left"), settingLeft, zNodes);
                });
            }
        }


        function addAllnodes() {
            var leftTree = $.fn.zTree.getZTreeObj("menu_tree_left");
            var leftSelectedNode = leftTree.getSelectedNodes()[0];
            
            if (!leftSelectedNode) return;
            
            var rightTree = $.fn.zTree.getZTreeObj("menu_tree_right");

            // 已经添加到右侧的的节点名字
            var added = rNodes.map(function (node) { return node.name });
            
            // 不存在的才添加
            if (added.indexOf(leftSelectedNode.name) !== -1) return;
                
            rNodes.push(leftSelectedNode);

            $.fn.zTree.init($("#menu_tree_right"), settingRight, rNodes);


//            if (!leftSelectedNode) return;
//
//            if (!leftSelectedNode[0].isParent) {
//                var addAll=document.getElementById('addAll');
//                addAll.onclick=function(){
//                    addAll.setAttribute('disabled','true');
//                }
//
//                console.log(leftSelectedNode[0].isParent)
//
//                return ;
//            }
//
//            if(leftSelectedNode[0].isParent){
//                $('.ztree li a.curSelectedNode').css({'color':'gray'});
//            }
//            //checkbox的状态控制
//            if(rightTree.getNodes()!=[]){
//                $(':checkbox').attr("checked",false);
//                $(':checkbox').click(function(){
//                    $.fn.zTree.init($("#menu_tree_Right"), settingRight, []);
//                    $.fn.zTree.init($("#menu_tree_left"), settingLeft, zNodes);
//                });
//            }

        }
		
//		$('#ensure').click(function(){
//			var right= $.fn.zTree.getZTreeObj("menu_tree_right");
//			console.log(right.getSelectedNodes()+'bb');
//			closemodel();
//		});

    </script>
</body>
</html>